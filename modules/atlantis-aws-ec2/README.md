# Terraform AWS EC2 Atlantis

Terraform module to set up a single EC2 instance to host [Atlantis](https://www.runatlantis.io/).
The EC2 uses Elatic IP (EIP) and is launched in the default VPC.
This module support terraform 0.12 only.

## Usage

Here is basic usage of this module with minimum input.

```hcl
module "atlantis" {
    source = "ringanta/ec2-atlantis/aws"
    version = "1.0.0"

    public_key = "ssh-rsa blablabla"
}
```

The `public_key` module argument must be filled with an SSH public key.
We can generate SSH private and public key pair using the following `ssh-keygen` command.

```shell
ssh-keygen -t rsa -b 2048 -f ~/.ssh/ec2_atlantis_rsa
```

Above command writes private and public key file to **~/.ssh/ec2_atlantis_rsa** and **~/.ssh/ec2_atlantis_rsa.pub**.

## Examples

- [Basic usage example](./examples/basic/)

## Providers

| Name | Version |
|------|---------|
| aws | n/a |
| random | n/a |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| ami\_id | The AMI ID of EC2 that will be launched. Default to Ubuntu 18.04 if left empty | `string` | `""` | no |
| attach\_admin\_policy | Flag to decide whether to attach AdministratorAccess policy to atlantis role | `bool` | `true` | no |
| instance\_type | Type of EC2 instance that will be launched | `string` | `"t3a.small"` | no |
| key\_name | Keypair name of the EC2. Mutually exclusive with the public\_key variable | `string` | `""` | no |
| public\_key | Public key material that will be used by EC2. If set, will create a new EC2 key pair with autogenerated name | `string` | `""` | no |
| root\_disk\_size | Size of the EC2 root disk size in GB | `number` | `20` | no |
| secgroup\_id | ID of security group that will be used by EC2. Leave it empty to use default allow ssh, http, and https from anywhere | `string` | `""` | no |
| subnet\_id | Subnet ID of the EC2. Will use subnet in default VPC if left empty | `string` | `""` | no |
| tags | Tags that will be added to the EC2 instance | `map(string)` | `{}` | no |

## Outputs

| Name | Description |
|------|-------------|
| atlantis\_ec2\_id | ID of the Atlantis EC2 |
| atlantis\_public\_ip | Elastic IP of the EC2 |
| atlantis\_role\_arn | ARN of the Atlantis EC2 role |
| atlantis\_role\_name | Role name for the Atlantis EC2 |
| atlantis\_security\_group | List of ID of security group for the Atlantis EC2 |
| atlantis\_ssh\_user | Username to ssh to the EC2 |
| atlantis\_xip\_domain | XIP based domain for the EC2 |

## Authors

This module is managed by [Roy Ginting](https://github.com/ringanta/).

## License

This module is licensed under Apache 2 license. See the `LICENSE` file for full details.
